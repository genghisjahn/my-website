<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ .Title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

    {{template "feeds"}}
    {{template "webmention"}}
    {{template "styles"}}
    {{template "favicons"}}
    <link rel="manifest" href="/site.webmanifest?v=2">
    <meta name="theme-color" content="#0a0e1a">

    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="{{ .Title }}">
    <meta property="og:url" content="https://jonwear.com/notes/{{ .Slug }}/">
    <meta property="og:site_name" content="jonwear.com">
    <meta property="og:image" content="https://jonwear.com/images/og-default.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ .Title }}">
    <meta name="twitter:image" content="https://jonwear.com/images/og-default.png">

    <!-- Fediverse -->
    <meta name="fediverse:creator" content="@Jon@route66.social">

</head>
<body>
  <div class="wrap">
    <div class="crt">
      {{template "theme-toggle"}}
      <nav class="site-nav">
        <a href="/">Home</a> · <a href="/archive/">Post Archive</a> / <a href="/feed.xml">RSS</a> · <a href="/notes/">Notes Archive</a> / <a href="/notes/feed.xml">RSS</a>
      </nav>
      <article class="h-entry">
      <header>
        <h1 class="p-name">{{ .Title }}</h1>
        <p class="byline">By <a class="p-author h-card" href="https://jonwear.com"><img class="u-photo" src="/images/jon2.webp" alt="{{ .Author.Name }}" style="display:none"><span class="p-name">{{ .Author.Name }}</span></a> · <time class="dt-published" datetime="{{ .Date }}">{{ .DateHuman }}</time></p>
        {{- if .Source }}
        <p class="source">Source: {{ if isURL .Source }}<a href="{{ deref .Source }}">{{ deref .Source }}</a>{{ else }}{{ deref .Source }}{{ end }}</p>
        {{- end }}
      </header>

      <div class="rule" aria-hidden="true"></div>
       <div class="e-content">
          {{ .ContentHTML }}
      </div>
      </article>

    {{- if .Tags }}
      <nav class="tags" aria-label="Tags">
        {{- range .Tags }}
          <a class="tag" href="/tag/{{ .Slug }}/">{{ .Name }}</a>
        {{- end }}
      </nav>
    {{- end }}

      <section id="webmentions" class="webmentions">
        <h3>Mentions</h3>
        <div id="facepile" class="facepile"></div>
      </section>

      <footer>
        <a href="/">Home</a> · <a href="/archive/">Post Archive</a> / <a href="/feed.xml">RSS</a> · <a href="/notes/">Notes Archive</a> / <a href="/notes/feed.xml">RSS</a>
      </footer>
      <script>
      (function() {
        var url = encodeURIComponent(window.location.href.replace(/\/$/, '') + '/');
        fetch('https://webmention.io/api/mentions.jf2?target=' + url)
          .then(function(r) { return r.json(); })
          .then(function(data) {
            var facepile = document.getElementById('facepile');
            if (!data.children || data.children.length === 0) {
              facepile.innerHTML = '<p class="no-mentions">No mentions yet.</p>';
              return;
            }
            var seen = {};
            data.children.forEach(function(mention) {
              var author = mention.author;
              var key = (author && author.url) || mention.url || mention['wm-id'];
              if (seen[key]) return;
              seen[key] = true;

              var el;
              if (author && author.photo) {
                el = document.createElement('img');
                el.src = author.photo;
                el.alt = author.name || 'Anonymous';
                el.title = author.name || 'Anonymous';
                el.className = 'facepile-avatar';
              } else {
                el = document.createElement('span');
                el.className = 'facepile-name';
                el.textContent = (author && author.name) || mention.name || 'Someone';
                el.title = mention.url || '';
              }

              var linkUrl = (author && author.url) || mention.url;
              if (linkUrl) {
                var link = document.createElement('a');
                link.href = linkUrl;
                link.rel = 'nofollow';
                link.appendChild(el);
                facepile.appendChild(link);
              } else {
                facepile.appendChild(el);
              }
            });
          })
          .catch(function() {});
      })();
      </script>
    </div>
  </div>
</body>
</html>
